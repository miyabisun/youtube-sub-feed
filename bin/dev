#!/usr/bin/env bash
set -euo pipefail
cd "$(dirname "$0")/.."

cleanup() { kill $VITE_PID 2>/dev/null || true; }
trap cleanup EXIT

# Frontend setup & watch build (background)
echo "==> Setting up frontend..."
cd client
npm install
npx vite build
echo "==> Starting frontend watch..."
npx vite build --watch &
VITE_PID=$!
cd ..

# Rust build & run
echo "==> Building server..."
cargo build

echo "==> Starting server..."
target/debug/youtube-sub-feed
